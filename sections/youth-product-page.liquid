{% comment %}
  P√ÅGINA DE PRODUCTO YOUTH - Optimizada para m√≥vil y conversi√≥n
  Incluye: Galer√≠a mejorada, informaci√≥n clara, reviews, productos relacionados
{% endcomment %}

<div class="youth-product-page" data-product-id="{{ product.id }}">
  <div class="youth-product-container">
    
    {% comment %} Galer√≠a de im√°genes {% endcomment %}
    <div class="youth-product-gallery">
      <div class="youth-gallery-main">
        {% for media in product.media %}
          <div class="youth-gallery-slide {% if forloop.first %}active{% endif %}" 
               data-media-id="{{ media.id }}">
            {% case media.media_type %}
              {% when 'image' %}
                <img 
                  src="{{ media | image_url: width: 800 }}" 
                  alt="{{ media.alt | escape }}"
                  loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
                  data-zoom="{{ media | image_url: width: 1600 }}"
                >
              {% when 'video' %}
                <video controls poster="{{ media.preview_image | image_url: width: 800 }}">
                  <source src="{{ media.sources[0].url }}" type="{{ media.sources[0].mime_type }}">
                </video>
              {% when 'model' %}
                <model-viewer 
                  src="{{ media.sources[0].url }}"
                  poster="{{ media.preview_image | image_url: width: 800 }}"
                  auto-rotate 
                  camera-controls
                  ar
                  ar-modes="webxr scene-viewer quick-look"
                ></model-viewer>
            {% endcase %}
          </div>
        {% endfor %}
      </div>
      
      {% comment %} Thumbnails {% endcomment %}
      {% if product.media.size > 1 %}
        <div class="youth-gallery-thumbs">
          {% for media in product.media %}
            <button class="youth-thumb {% if forloop.first %}active{% endif %}" 
                    data-media-id="{{ media.id }}"
                    type="button">
              <img src="{{ media | image_url: width: 100 }}" 
                   alt="{{ media.alt | escape }}">
              {% if media.media_type == 'video' %}
                <div class="youth-thumb-play">‚ñ∂</div>
              {% elsif media.media_type == 'model' %}
                <div class="youth-thumb-3d">3D</div>
              {% endif %}
            </button>
          {% endfor %}
        </div>
      {% endif %}
      
      {% comment %} Badges/Etiquetas {% endcomment %}
      <div class="youth-product-badges">
        {% if product.compare_at_price > product.price %}
          <span class="youth-badge youth-badge--sale">
            OFERTA
          </span>
        {% endif %}
        {% if product.tags contains 'new' %}
          <span class="youth-badge youth-badge--new">NUEVO</span>
        {% endif %}
        {% if product.tags contains 'bestseller' %}
          <span class="youth-badge youth-badge--bestseller">BEST SELLER</span>
        {% endif %}
      </div>
    </div>
    
    {% comment %} Informaci√≥n del producto {% endcomment %}
    <div class="youth-product-info">
      <div class="youth-product-header">
        <h1 class="youth-product-title">{{ product.title | escape }}</h1>
        
        {% comment %} Reviews/Rating {% endcomment %}
        {% if product.metafields.reviews.rating.value %}
          <div class="youth-product-rating">
            {% assign rating = product.metafields.reviews.rating.value %}
            <div class="youth-stars">
              {% for i in (1..5) %}
                <span class="youth-star {% if i <= rating %}filled{% endif %}">‚òÖ</span>
              {% endfor %}
            </div>
            <span class="youth-rating-text">
              {{ rating }} ({{ product.metafields.reviews.rating_count.value | default: '0' }} rese√±as)
            </span>
          </div>
        {% endif %}
        
        {% comment %} Precio {% endcomment %}
        <div class="youth-price-container">
          {% if product.compare_at_price > product.price %}
            <span class="youth-price-sale">{{ product.price | money }}</span>
            <span class="youth-price-compare">{{ product.compare_at_price | money }}</span>
            <span class="youth-discount-percent">
              -{{ product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price }}%
            </span>
          {% else %}
            <span class="youth-price-regular">{{ product.price | money }}</span>
          {% endif %}
        </div>
      </div>
      
      {% comment %} Descripci√≥n corta {% endcomment %}
      {% if product.description != blank %}
        <div class="youth-product-description">
          {{ product.description | truncate: 200 | strip_html }}
          {% if product.description.size > 200 %}
            <button class="youth-read-more" type="button">Leer m√°s</button>
          {% endif %}
        </div>
      {% endif %}
      
      {% comment %} Form de variantes {% endcomment %}
      <form class="youth-product-form" action="/cart/add" method="post" enctype="multipart/form-data">
        {% unless product.has_only_default_variant %}
          <div class="youth-variants">
            {% for option in product.options_with_values %}
              <div class="youth-variant-group" data-option-name="{{ option.name | downcase | escape }}">
                <label class="youth-variant-label">
                  {{ option.name | escape }}:
                  <span class="youth-selected-value"></span>
                </label>
                
                <div class="youth-variant-options">
                  {% case option.name %}
                    {% when 'Color' or 'Colour' %}
                      {% for value in option.values %}
                        <input type="radio" 
                               id="option-{{ option.position }}-{{ forloop.index }}"
                               name="options[{{ option.name | escape }}]"
                               value="{{ value | escape }}"
                               {% if option.selected_value == value %}checked{% endif %}>
                        <label for="option-{{ option.position }}-{{ forloop.index }}" 
                               class="youth-color-option"
                               data-color="{{ value | downcase | replace: ' ', '' }}"
                               title="{{ value | escape }}">
                          <span class="youth-color-swatch" 
                                style="background-color: {{ value | downcase | replace: ' ', '' }}"></span>
                          <span class="youth-color-name">{{ value | escape }}</span>
                        </label>
                      {% endfor %}
                    
                    {% when 'Size' or 'Talla' %}
                      {% for value in option.values %}
                        <input type="radio" 
                               id="option-{{ option.position }}-{{ forloop.index }}"
                               name="options[{{ option.name | escape }}]"
                               value="{{ value | escape }}"
                               {% if option.selected_value == value %}checked{% endif %}>
                        <label for="option-{{ option.position }}-{{ forloop.index }}" 
                               class="youth-size-option">
                          {{ value | escape }}
                        </label>
                      {% endfor %}
                      
                      <button type="button" class="youth-size-guide" data-modal="size-guide">
                        üìè Gu√≠a de talles
                      </button>
                    
                    {% else %}
                      {% for value in option.values %}
                        <input type="radio" 
                               id="option-{{ option.position }}-{{ forloop.index }}"
                               name="options[{{ option.name | escape }}]"
                               value="{{ value | escape }}"
                               {% if option.selected_value == value %}checked{% endif %}>
                        <label for="option-{{ option.position }}-{{ forloop.index }}" 
                               class="youth-text-option">
                          {{ value | escape }}
                        </label>
                      {% endfor %}
                  {% endcase %}
                </div>
              </div>
            {% endfor %}
          </div>
        {% endunless %}
        
        <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
        
        {% comment %} Cantidad y Add to Cart {% endcomment %}
        <div class="youth-purchase-controls">
          <div class="youth-quantity">
            <label for="quantity">Cantidad:</label>
            <div class="youth-quantity-selector">
              <button type="button" class="youth-qty-btn" data-action="decrease">‚àí</button>
              <input type="number" 
                     id="quantity" 
                     name="quantity" 
                     value="1" 
                     min="1" 
                     max="{{ product.selected_or_first_available_variant.inventory_quantity }}"
                     readonly>
              <button type="button" class="youth-qty-btn" data-action="increase">+</button>
            </div>
          </div>
          
          <div class="youth-add-to-cart-group">
            <button type="submit" 
                    class="youth-add-to-cart btn-youth-primary"
                    {% unless product.available %}disabled{% endunless %}>
              {% if product.available %}
                <span class="youth-cart-text">Agregar al carrito</span>
                <span class="youth-cart-price">{{ product.selected_or_first_available_variant.price | money }}</span>
              {% else %}
                Agotado
              {% endif %}
            </button>
            
            {% if product.available %}
              <button type="button" class="youth-buy-now btn-youth-secondary">
                Comprar ahora
              </button>
            {% endif %}
          </div>
        </div>
      </form>
      
      {% comment %} Informaci√≥n adicional {% endcomment %}
      <div class="youth-product-features">
        <div class="youth-feature">
          <span class="youth-feature-icon">üöö</span>
          <span>Env√≠o gratis en compras +$50</span>
        </div>
        <div class="youth-feature">
          <span class="youth-feature-icon">‚Ü©Ô∏è</span>
          <span>Devoluciones hasta 30 d√≠as</span>
        </div>
        <div class="youth-feature">
          <span class="youth-feature-icon">üí≥</span>
          <span>Pago seguro y cifrado</span>
        </div>
        <div class="youth-feature">
          <span class="youth-feature-icon">üì±</span>
          <span>Soporte 24/7 via WhatsApp</span>
        </div>
      </div>
      
      {% comment %} Share buttons {% endcomment %}
      <div class="youth-share">
        <span class="youth-share-label">Compartir:</span>
        <a href="https://www.facebook.com/sharer/sharer.php?u={{ shop.url }}{{ product.url }}" 
           target="_blank" 
           class="youth-share-btn youth-share-facebook"
           rel="noopener">
          Facebook
        </a>
        <a href="https://twitter.com/intent/tweet?text={{ product.title | escape }}&url={{ shop.url }}{{ product.url }}" 
           target="_blank" 
           class="youth-share-btn youth-share-twitter"
           rel="noopener">
          Twitter
        </a>
        <button type="button" class="youth-share-btn youth-share-copy" data-url="{{ shop.url }}{{ product.url }}">
          Copiar link
        </button>
      </div>
    </div>
  </div>
  
  {% comment %} Descripci√≥n completa y detalles {% endcomment %}
  {% if product.description.size > 200 %}
    <div class="youth-product-details hidden" id="full-description">
      <div class="section-container">
        <h3>Detalles del producto</h3>
        <div class="youth-description-content">
          {{ product.description }}
        </div>
      </div>
    </div>
  {% endif %}
</div>

{% comment %} Modal de gu√≠a de talles {% endcomment %}
<div class="youth-modal" id="size-guide-modal">
  <div class="youth-modal-content">
    <div class="youth-modal-header">
      <h3>Gu√≠a de talles</h3>
      <button class="youth-modal-close">&times;</button>
    </div>
    <div class="youth-modal-body">
      <div class="youth-size-chart">
        <table>
          <thead>
            <tr>
              <th>Talla</th>
              <th>Pecho (cm)</th>
              <th>Cintura (cm)</th>
              <th>Cadera (cm)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>XS</td>
              <td>80-84</td>
              <td>60-64</td>
              <td>86-90</td>
            </tr>
            <tr>
              <td>S</td>
              <td>84-88</td>
              <td>64-68</td>
              <td>90-94</td>
            </tr>
            <tr>
              <td>M</td>
              <td>88-92</td>
              <td>68-72</td>
              <td>94-98</td>
            </tr>
            <tr>
              <td>L</td>
              <td>92-96</td>
              <td>72-76</td>
              <td>98-102</td>
            </tr>
            <tr>
              <td>XL</td>
              <td>96-100</td>
              <td>76-80</td>
              <td>102-106</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<style>
  .youth-product-page {
    padding: var(--spacing-youth-md);
  }
  
  .youth-product-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--spacing-youth-xl);
    max-width: 1200px;
    margin: 0 auto;
  }
  
  /* Galer√≠a */
  .youth-product-gallery {
    position: relative;
  }
  
  .youth-gallery-main {
    position: relative;
    margin-bottom: var(--spacing-youth-md);
    border-radius: 16px;
    overflow: hidden;
    background: #f8f8f8;
  }
  
  .youth-gallery-slide {
    display: none;
    aspect-ratio: 4/5;
  }
  
  .youth-gallery-slide.active {
    display: block;
  }
  
  .youth-gallery-slide img,
  .youth-gallery-slide video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    cursor: zoom-in;
  }
  
  .youth-gallery-thumbs {
    display: flex;
    gap: var(--spacing-youth-xs);
    overflow-x: auto;
    padding-bottom: 4px;
  }
  
  .youth-thumb {
    position: relative;
    flex-shrink: 0;
    width: 80px;
    height: 80px;
    border: 2px solid transparent;
    border-radius: 12px;
    overflow: hidden;
    background: none;
    cursor: pointer;
    transition: var(--youth-transition);
  }
  
  .youth-thumb.active {
    border-color: var(--youth-primary);
  }
  
  .youth-thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .youth-thumb-play,
  .youth-thumb-3d {
    position: absolute;
    bottom: 4px;
    right: 4px;
    background: rgba(0,0,0,0.8);
    color: white;
    font-size: 0.7rem;
    padding: 2px 4px;
    border-radius: 4px;
  }
  
  .youth-product-badges {
    position: absolute;
    top: 16px;
    left: 16px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    z-index: 2;
  }
  
  /* Informaci√≥n del producto */
  .youth-product-title {
    font-family: var(--font-youth-heading);
    font-size: 2rem;
    font-weight: 800;
    color: var(--youth-dark);
    line-height: 1.2;
    margin-bottom: var(--spacing-youth-sm);
  }
  
  .youth-product-rating {
    display: flex;
    align-items: center;
    gap: var(--spacing-youth-xs);
    margin-bottom: var(--spacing-youth-sm);
  }
  
  .youth-stars {
    color: var(--youth-accent);
    font-size: 1.2rem;
  }
  
  .youth-star.filled {
    color: var(--youth-accent);
  }
  
  .youth-rating-text {
    color: #666;
    font-size: 0.9rem;
  }
  
  .youth-price-container {
    display: flex;
    align-items: center;
    gap: var(--spacing-youth-sm);
    margin-bottom: var(--spacing-youth-md);
  }
  
  .youth-price-sale {
    font-size: 2rem;
    font-weight: 800;
    color: var(--youth-primary);
  }
  
  .youth-price-compare {
    font-size: 1.2rem;
    color: #999;
    text-decoration: line-through;
  }
  
  .youth-discount-percent {
    background: var(--youth-primary);
    color: white;
    padding: 4px 8px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 700;
  }
  
  .youth-price-regular {
    font-size: 2rem;
    font-weight: 800;
    color: var(--youth-dark);
  }
  
  .youth-product-description {
    margin-bottom: var(--spacing-youth-lg);
    font-family: var(--font-youth-body);
    line-height: 1.6;
    color: #666;
  }
  
  .youth-read-more {
    background: none;
    border: none;
    color: var(--youth-primary);
    font-weight: 600;
    cursor: pointer;
    text-decoration: underline;
  }
  
  /* Variantes */
  .youth-variants {
    margin-bottom: var(--spacing-youth-lg);
  }
  
  .youth-variant-group {
    margin-bottom: var(--spacing-youth-md);
  }
  
  .youth-variant-label {
    display: block;
    font-weight: 600;
    margin-bottom: var(--spacing-youth-xs);
    color: var(--youth-dark);
  }
  
  .youth-selected-value {
    color: var(--youth-primary);
  }
  
  .youth-variant-options {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-youth-xs);
  }
  
  .youth-variant-options input[type="radio"] {
    display: none;
  }
  
  .youth-color-option,
  .youth-size-option,
  .youth-text-option {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 16px;
    border: 2px solid #ddd;
    border-radius: 12px;
    cursor: pointer;
    transition: var(--youth-transition);
    font-weight: 500;
  }
  
  .youth-variant-options input:checked + label {
    border-color: var(--youth-primary);
    background: rgba(255, 107, 53, 0.1);
    color: var(--youth-primary);
  }
  
  .youth-color-swatch {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 1px solid #ddd;
  }
  
  .youth-size-guide {
    background: none;
    border: none;
    color: var(--youth-primary);
    font-size: 0.9rem;
    text-decoration: underline;
    cursor: pointer;
    margin-top: var(--spacing-youth-xs);
  }
  
  /* Controles de compra */
  .youth-purchase-controls {
    margin-bottom: var(--spacing-youth-lg);
  }
  
  .youth-quantity {
    display: flex;
    align-items: center;
    gap: var(--spacing-youth-sm);
    margin-bottom: var(--spacing-youth-sm);
  }
  
  .youth-quantity-selector {
    display: flex;
    align-items: center;
    border: 2px solid #ddd;
    border-radius: 12px;
    overflow: hidden;
  }
  
  .youth-qty-btn {
    width: 40px;
    height: 40px;
    border: none;
    background: #f8f8f8;
    font-size: 1.2rem;
    font-weight: 700;
    cursor: pointer;
    transition: var(--youth-transition);
  }
  
  .youth-qty-btn:hover {
    background: var(--youth-primary);
    color: white;
  }
  
  .youth-quantity input {
    width: 60px;
    height: 40px;
    border: none;
    text-align: center;
    font-weight: 600;
    background: white;
  }
  
  .youth-add-to-cart-group {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-youth-sm);
  }
  
  .youth-add-to-cart {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 24px;
    font-size: 1.1rem;
    width: 100%;
  }
  
  .youth-buy-now {
    width: 100%;
    padding: 16px 24px;
    font-size: 1.1rem;
  }
  
  /* Features */
  .youth-product-features {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--spacing-youth-sm);
    margin-bottom: var(--spacing-youth-lg);
    padding: var(--spacing-youth-md);
    background: #f8f8f8;
    border-radius: 16px;
  }
  
  .youth-feature {
    display: flex;
    align-items: center;
    gap: var(--spacing-youth-xs);
    font-size: 0.9rem;
    color: #666;
  }
  
  .youth-feature-icon {
    font-size: 1.2rem;
  }
  
  /* Share */
  .youth-share {
    display: flex;
    align-items: center;
    gap: var(--spacing-youth-sm);
    padding-top: var(--spacing-youth-md);
    border-top: 1px solid #ddd;
  }
  
  .youth-share-btn {
    padding: 8px 16px;
    border: 1px solid #ddd;
    border-radius: 20px;
    background: white;
    color: #666;
    text-decoration: none;
    font-size: 0.85rem;
    transition: var(--youth-transition);
  }
  
  .youth-share-btn:hover {
    border-color: var(--youth-primary);
    color: var(--youth-primary);
  }
  
  /* Modal */
  .youth-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    z-index: 1000;
  }
  
  .youth-modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .youth-modal-content {
    background: white;
    border-radius: 16px;
    max-width: 600px;
    width: 90%;
    max-height: 80%;
    overflow-y: auto;
  }
  
  .youth-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-youth-md);
    border-bottom: 1px solid #ddd;
  }
  
  .youth-modal-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
  }
  
  .youth-size-chart table {
    width: 100%;
    border-collapse: collapse;
    margin: var(--spacing-youth-md);
  }
  
  .youth-size-chart th,
  .youth-size-chart td {
    padding: 12px;
    text-align: center;
    border: 1px solid #ddd;
  }
  
  .youth-size-chart th {
    background: #f8f8f8;
    font-weight: 700;
  }
  
  /* Responsive */
  @media (max-width: 768px) {
    .youth-product-container {
      grid-template-columns: 1fr;
      gap: var(--spacing-youth-md);
    }
    
    .youth-product-title {
      font-size: 1.5rem;
    }
    
    .youth-price-sale,
    .youth-price-regular {
      font-size: 1.5rem;
    }
    
    .youth-product-features {
      grid-template-columns: 1fr;
    }
    
    .youth-share {
      flex-wrap: wrap;
    }
    
    .youth-add-to-cart-group {
      position: sticky;
      bottom: 0;
      background: white;
      padding: var(--spacing-youth-md);
      margin: 0 -16px;
      border-top: 1px solid #ddd;
    }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Gallery functionality
  const thumbs = document.querySelectorAll('.youth-thumb');
  const slides = document.querySelectorAll('.youth-gallery-slide');
  
  thumbs.forEach(thumb => {
    thumb.addEventListener('click', function() {
      const mediaId = this.dataset.mediaId;
      
      // Update active states
      thumbs.forEach(t => t.classList.remove('active'));
      slides.forEach(s => s.classList.remove('active'));
      
      this.classList.add('active');
      document.querySelector(`[data-media-id="${mediaId}"]`).classList.add('active');
    });
  });
  
  // Quantity controls
  const qtyButtons = document.querySelectorAll('.youth-qty-btn');
  const qtyInput = document.getElementById('quantity');
  
  qtyButtons.forEach(btn => {
    btn.addEventListener('click', function() {
      const action = this.dataset.action;
      let currentQty = parseInt(qtyInput.value);
      
      if (action === 'increase' && currentQty < parseInt(qtyInput.max)) {
        qtyInput.value = currentQty + 1;
      } else if (action === 'decrease' && currentQty > 1) {
        qtyInput.value = currentQty - 1;
      }
      
      // Update price in button
      const priceSpan = document.querySelector('.youth-cart-price');
      if (priceSpan) {
        const basePrice = parseFloat(priceSpan.dataset.basePrice || priceSpan.textContent.replace(/[^0-9.]/g, ''));
        const newTotal = basePrice * parseInt(qtyInput.value);
        priceSpan.textContent = `$${newTotal.toFixed(2)}`;
      }
    });
  });
  
  // Variant selection
  const variantInputs = document.querySelectorAll('.youth-variant-options input[type="radio"]');
  
  variantInputs.forEach(input => {
    input.addEventListener('change', function() {
      const group = this.closest('.youth-variant-group');
      const selectedValue = group.querySelector('.youth-selected-value');
      selectedValue.textContent = this.value;
      
      // Update variant ID and price based on selection
      updateVariant();
    });
  });
  
  // Size guide modal
  const sizeGuideBtn = document.querySelector('.youth-size-guide');
  const modal = document.getElementById('size-guide-modal');
  const closeBtn = document.querySelector('.youth-modal-close');
  
  if (sizeGuideBtn) {
    sizeGuideBtn.addEventListener('click', function() {
      modal.classList.add('active');
    });
  }
  
  if (closeBtn) {
    closeBtn.addEventListener('click', function() {
      modal.classList.remove('active');
    });
  }
  
  // Close modal on backdrop click
  modal?.addEventListener('click', function(e) {
    if (e.target === this) {
      this.classList.remove('active');
    }
  });
  
  // Share functionality
  const copyBtn = document.querySelector('.youth-share-copy');
  if (copyBtn) {
    copyBtn.addEventListener('click', function() {
      navigator.clipboard.writeText(this.dataset.url).then(() => {
        this.textContent = '¬°Copiado!';
        setTimeout(() => {
          this.textContent = 'Copiar link';
        }, 2000);
      });
    });
  }
  
  // Read more functionality
  const readMoreBtn = document.querySelector('.youth-read-more');
  const fullDescription = document.getElementById('full-description');
  
  if (readMoreBtn && fullDescription) {
    readMoreBtn.addEventListener('click', function() {
      fullDescription.classList.toggle('hidden');
      this.textContent = fullDescription.classList.contains('hidden') ? 'Leer m√°s' : 'Leer menos';
    });
  }
  
  function updateVariant() {
    // This would typically integrate with Shopify's variant selection logic
    // For now, just a placeholder
    console.log('Updating variant based on selections');
  }
});
</script>
